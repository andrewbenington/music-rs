// Octave 0
pub const C0: f32 = 16.35;
pub const CSH0: f32 = 17.32;
pub const DFL0: f32 = 17.32;
pub const D0: f32 = 18.35;
pub const DSH0: f32 = 19.45;
pub const EFL0: f32 = 19.45;
pub const E0: f32 = 20.60;
pub const F0: f32 = 21.83;
pub const FSH0: f32 = 23.12;
pub const GFL0: f32 = 23.12;
pub const G0: f32 = 24.50;
pub const GSH0: f32 = 25.96;
pub const AFL0: f32 = 25.96;
pub const A0: f32 = 27.50;
pub const ASH0: f32 = 29.14;
pub const BFL0: f32 = 29.14;
pub const B0: f32 = 30.87;

// Octave 1
pub const C1: f32 = 32.70;
pub const CSH1: f32 = 34.65;
pub const DFL1: f32 = 34.65;
pub const D1: f32 = 36.71;
pub const DSH1: f32 = 38.89;
pub const EFL1: f32 = 38.89;
pub const E1: f32 = 41.20;
pub const F1: f32 = 43.65;
pub const FSH1: f32 = 46.25;
pub const GFL1: f32 = 46.25;
pub const G1: f32 = 49.00;
pub const GSH1: f32 = 51.91;
pub const AFL1: f32 = 51.91;
pub const A1: f32 = 55.00;
pub const ASH1: f32 = 58.27;
pub const BFL1: f32 = 58.27;
pub const B1: f32 = 61.74;

// Octave 2
pub const C2: f32 = 65.41;
pub const CSH2: f32 = 69.30;
pub const DFL2: f32 = 69.30;
pub const D2: f32 = 73.42;
pub const DSH2: f32 = 77.78;
pub const EFL2: f32 = 77.78;
pub const E2: f32 = 82.41;
pub const F2: f32 = 87.31;
pub const FSH2: f32 = 92.50;
pub const GFL2: f32 = 92.50;
pub const G2: f32 = 98.00;
pub const GSH2: f32 = 103.83;
pub const AFL2: f32 = 103.83;
pub const A2: f32 = 110.00;
pub const ASH2: f32 = 116.54;
pub const BFL2: f32 = 116.54;
pub const B2: f32 = 123.47;

// Octave 3
pub const C3: f32 = 130.81;
pub const CSH3: f32 = 138.59;
pub const DFL3: f32 = 138.59;
pub const D3: f32 = 146.83;
pub const DSH3: f32 = 155.56;
pub const EFL3: f32 = 155.56;
pub const E3: f32 = 164.81;
pub const F3: f32 = 174.61;
pub const FSH3: f32 = 185.00;
pub const GFL3: f32 = 185.00;
pub const G3: f32 = 196.00;
pub const GSH3: f32 = 207.65;
pub const AFL3: f32 = 207.65;
pub const A3: f32 = 220.00;
pub const ASH3: f32 = 233.08;
pub const BFL3: f32 = 233.08;
pub const B3: f32 = 246.94;

// Octave 4
pub const C4: f32 = 261.63;
pub const CSH4: f32 = 277.18;
pub const DFL4: f32 = 277.18;
pub const D4: f32 = 293.66;
pub const DSH4: f32 = 311.13;
pub const EFL4: f32 = 311.13;
pub const E4: f32 = 329.63;
pub const F4: f32 = 349.23;
pub const FSH4: f32 = 369.99;
pub const GFL4: f32 = 369.99;
pub const G4: f32 = 392.00;
pub const GSH4: f32 = 415.30;
pub const AFL4: f32 = 415.30;
pub const A4: f32 = 440.00;
pub const ASH4: f32 = 466.16;
pub const BFL4: f32 = 466.16;
pub const B4: f32 = 493.88;

// Octave 5
pub const C5: f32 = 523.25;
pub const CSH5: f32 = 554.37;
pub const DFL5: f32 = 554.37;
pub const D5: f32 = 587.33;
pub const DSH5: f32 = 622.25;
pub const EFL5: f32 = 622.25;
pub const E5: f32 = 659.25;
pub const F5: f32 = 698.46;
pub const FSH5: f32 = 739.99;
pub const GFL5: f32 = 739.99;
pub const G5: f32 = 783.99;
pub const GSH5: f32 = 830.61;
pub const AFL5: f32 = 830.61;
pub const A5: f32 = 880.00;
pub const ASH5: f32 = 932.33;
pub const BFL5: f32 = 932.33;
pub const B5: f32 = 987.77;

// Octave 6
pub const C6: f32 = 1046.50;
pub const CSH6: f32 = 1108.73;
pub const DFL6: f32 = 1108.73;
pub const D6: f32 = 1174.66;
pub const DSH6: f32 = 1244.51;
pub const EFL6: f32 = 1244.51;
pub const E6: f32 = 1318.51;
pub const F6: f32 = 1396.91;
pub const FSH6: f32 = 1479.98;
pub const GFL6: f32 = 1479.98;
pub const G6: f32 = 1567.98;
pub const GSH6: f32 = 1661.22;
pub const AFL6: f32 = 1661.22;
pub const A6: f32 = 1760.00;
pub const ASH6: f32 = 1864.66;
pub const BFL6: f32 = 1864.66;
pub const B6: f32 = 1975.53;

// Octave 7
pub const C7: f32 = 2093.00;
pub const CSH7: f32 = 2217.46;
pub const DFL7: f32 = 2217.46;
pub const D7: f32 = 2349.32;
pub const DSH7: f32 = 2489.02;
pub const EFL7: f32 = 2489.02;
pub const E7: f32 = 2637.02;
pub const F7: f32 = 2793.83;
pub const FSH7: f32 = 2959.96;
pub const GFL7: f32 = 2959.96;
pub const G7: f32 = 3135.96;
pub const GSH7: f32 = 3322.44;
pub const AFL7: f32 = 3322.44;
pub const A7: f32 = 3520.00;
pub const ASH7: f32 = 3729.31;
pub const BFL7: f32 = 3729.31;
pub const B7: f32 = 3951.07;

// Octave 8
pub const C8: f32 = 4186.01;
pub const CSH8: f32 = 4434.92;
pub const DFL8: f32 = 4434.92;
pub const D8: f32 = 4698.63;
pub const DSH8: f32 = 4978.03;
pub const EFL8: f32 = 4978.03;
pub const E8: f32 = 5274.04;
pub const F8: f32 = 5587.65;
pub const FSH8: f32 = 5919.91;
pub const GFL8: f32 = 5919.91;
pub const G8: f32 = 6271.93;
pub const GSH8: f32 = 6644.88;
pub const AFL8: f32 = 6644.88;
pub const A8: f32 = 7040.00;
pub const ASH8: f32 = 7458.62;
pub const BFL8: f32 = 7458.62;
pub const B8: f32 = 7902.13;

pub fn raise_half(note: f32, steps: i32) -> f32 {
    let mut steps_left = steps;
    let mut freq = note;
    while steps_left >= 12 {
        steps_left -= 12;
        freq *= 2.0;
    }

    while steps_left <= -12 {
        steps_left += 12;
        freq *= 0.5;
    }
    // println!(
    //     "freq: {}, steps: {}",
    //     freq * (2.0_f32).powf(steps_left as f32 / 12.0),
    //     steps
    // );
    return freq * (2.0_f32).powf(steps_left as f32 / 12.0);
}

pub fn raise_whole(note: f32, steps: i32) -> f32 {
    return raise_half(note, steps * 2);
}

pub fn min_3rd_up(note: f32) -> f32 {
    return raise_half(note, 3);
}

pub fn maj_3rd_up(note: f32) -> f32 {
    return raise_half(note, 4);
}

pub fn major_scale(start: f32) -> Vec<f32> {
    let mut scale: Vec<f32> = vec![0.0; 8];
    let mut next = start;
    for i in 0..8 {
        scale[i] = next;
        if i != 2 && i != 6 {
            next = raise_whole(next, 1)
        } else {
            next = raise_half(next, 1)
        }
    }
    return scale;
}

pub fn minor_scale_mel(start: f32) -> Vec<f32> {
    let mut scale: Vec<f32> = vec![0.0; 8];
    let mut next = start;
    for i in 0..8 {
        scale[i] = next;
        if i != 1 && i != 5 {
            next = raise_whole(next, 1)
        } else {
            next = raise_half(next, 1)
        }
    }
    return scale;
}

pub fn minor_scale_har(start: f32) -> Vec<f32> {
    let mut scale: Vec<f32> = vec![0.0; 8];
    let mut next = start;
    for i in 0..8 {
        scale[i] = next;
        if i == 5 {
            next = raise_half(next, 3)
        } else if i != 1 && i != 4 && i != 6 {
            next = raise_whole(next, 1)
        } else {
            next = raise_half(next, 1)
        }
    }
    return scale;
}

pub fn freq_from_note(note_str: &str) -> Result<f32, &'static str> {
    let mut note_ch: Option<char> = None;
    let mut flat_sharp_ch: Option<char> = None;
    let mut octave_opt: Option<u32> = None;

    for ch in note_str.chars().by_ref() {
        if note_ch.is_none() {
            if ('A'..='G').contains(&ch.to_ascii_uppercase()) {
                note_ch = Some(ch.to_ascii_uppercase());
            } else {
                return Err("Invalid note");
            }
        } else if octave_opt.is_none() {
            if ch == 'b' || ch == '#' {
                flat_sharp_ch = Some(ch);
            } else {
                octave_opt = ch.to_digit(10);
                if octave_opt.is_none() {
                    return Err("Invalid octave");
                }
            }
        } else {
            break;
        }
    }

    if note_ch.is_none() {
        return Err("Invalid note");
    }
    let note = note_ch.unwrap_or('F');
    let octave = octave_opt.unwrap_or(4);

    let c4_octave_distance = (octave as i32) - 4;
    let mut c4_half_step_distance = match note {
        'C' => 0,
        'D' => 2,
        'E' => 4,
        'F' => 5,
        'G' => 7,
        'A' => 9,
        'B' => 11,
        _ => 0,
    };

    if flat_sharp_ch.is_some_and(|ch| ch == 'b') {
        c4_half_step_distance -= 1;
    } else if flat_sharp_ch.is_some_and(|ch| ch == '#') {
        c4_half_step_distance += 1;
    }

    // println!(
    //     "Note: {}{}\nSteps: {}\nOctaves: {}",
    //     note, octave, c4_half_step_distance, c4_octave_distance
    // );

    let mut tone = C4 * (2.0_f32).powf(c4_octave_distance as f32) as f32;

    tone = raise_half(tone, c4_half_step_distance);

    return Ok(tone);
}
